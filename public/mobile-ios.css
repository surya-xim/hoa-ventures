/* iOS Optimization & Mobile Friendly Overrides */

:root {
    --safe-top: env(safe-area-inset-top);
    --safe-bottom: env(safe-area-inset-bottom);
    --safe-left: env(safe-area-inset-left);
    --safe-right: env(safe-area-inset-right);
}

/* Base Mobile Adjustments */
@media (max-width: 768px) {

    /* 1. Prevent iOS Input Zoom & Better Touch */
    input,
    select,
    textarea {
        font-size: 16px !important;
        /* Critical for iOS */
    }

    /* Remove iOS default style */
    input[type="text"],
    input[type="number"],
    input[type="email"],
    input[type="tel"],
    input[type="date"],
    select,
    textarea {
        -webkit-appearance: none;
        appearance: none;
    }

    /* 2. Layout Stacking */
    .grid:not(.hidden),
    .two-cols:not(.hidden),
    .dash-stats,
    .track-controls-bar {
        grid-template-columns: 1fr !important;
        flex-direction: column !important;
        display: flex !important;
        gap: 16px !important;
        width: 100% !important;
    }

    .hidden {
        display: none !important;
    }

    /* 3. Table Horizontal Scroll - Apply to wrappers */
    .track-panel .items {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 4px;
    }

    /* Only stack simple tables if needed, but for Track/Exp allow scroll */
    #expTable,
    #trackTable {
        display: block;
        overflow-x: auto;
        width: 100%;
    }

    /* 4. Safe Area Spacing & Full Height */
    .sidebar,
    .topbar {
        padding-top: max(16px, var(--safe-top));
    }

    .sidebar {
        padding-bottom: max(16px, var(--safe-bottom));
    }

    body {
        padding-bottom: var(--safe-bottom);
        overscroll-behavior-y: none;
        /* Prevent pull-to-refresh if not needed */
    }

    /* 5. Mobile Sidebar Animation - Performance Optimized */
    .sidebar {
        transform: translateX(-100%);
        left: 0 !important;
        /* Override styles.css */
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: fixed;
        z-index: 2000;
        height: 100vh;
        width: 280px;
        top: 0;
        bottom: 0;
        box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
    }

    .sidebar.open {
        transform: translateX(0);
        left: 0 !important;
    }

    /* Overlay */
    .sidebar-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(4px);
        z-index: 1999;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
    }

    .sidebar-overlay.active {
        opacity: 1;
        pointer-events: auto;
    }

    /* 6. Modal Bottom Sheet Style */
    .modal {
        align-items: flex-end;
        /* Bottom alignment */
        padding: 0 !important;
    }

    /* Reset modal content for mobile */
    .modal-content,
    .modal-card {
        width: 100% !important;
        max-width: 100% !important;
        border-radius: 24px 24px 0 0 !important;
        margin: 0 !important;
        padding: 24px !important;
        padding-bottom: max(32px, var(--safe-bottom)) !important;
        animation: slideUpMobile 0.3s ease-out !important;
        max-height: 90vh;
        overflow-y: auto;
    }

    @keyframes slideUpMobile {
        from {
            transform: translateY(100%);
        }

        to {
            transform: translateY(0);
        }
    }

    .close-modal {
        top: 24px !important;
        right: 24px !important;
        background: #f0f0f0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
    }

    /* 7. Hide Desktop Only Elements */
    .desktop-only {
        display: none !important;
    }

    /* 8. Expense Form Mobile Tweaks */
    .form-row {
        flex-direction: column !important;
        gap: 0 !important;
    }

    .stat-card {
        min-height: auto !important;
    }

    /* Adjust charts height */
    canvas {
        max-height: 250px !important;
    }
}